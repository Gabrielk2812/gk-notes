<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your Notes | GK NOTES</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
    <link rel="stylesheet" href="style.css">
    <link rel="shortcut icon" href="./assets/icon_purplecircle.png" type="image/x-icon">
    <script src="./script.js"></script>
</head>

<body onload="ReadUserData()">
    <header
        class="d-flex justify-content-between align-items-center px-4 py-3 text-white shadow-sm position-fixed top-0 start-0 w-100">
        <div class="d-flex align-items-center gap-3">
            <a href="./main.html"><img src="./assets/icon_whitecircle.png" alt="GK NOTES Logo" width="75" height="75"
                    class="rounded-circle" id="siteIcon"></a>
            <button class="btn btn-outline-light rounded-pill px-3 addNoteBtn" title="Add new note">+ Add</button>
        </div>


        <div class="d-flex align-items-center gap-3">
            <button class="btn btn-outline-light rounded-circle" id="toggleDarkMode"
                title="Toggle dark mode">ðŸŒ™</button>

            <button class="btn btn-outline-light rounded-circle" id="LogOutButton" title="Log Out">ðŸšª</button>

            <div class="profile-container" title="Your Profile" onclick="openProfileEditingModal()">
                <div class="profile-pill">
                    <div class="profile-circle text-white d-flex justify-content-center align-items-center text-center"
                        id="profile-pill">
                        <span id="profile-pill-span"></span>
                    </div>
                    <span class="username ms-2" id="usernamePfp"></span>
                </div>
            </div>
        </div>
    </header>
    <div class="container mt-5 pt-5">
        <h1 class="text-center my-4" id="userInfoDisplay">ðŸ‘‹Hello <span id="usernameTitle"></span>, here are your
            notes...</h1>

        <!--PROFILE EDITING MODAL-->
        <div
            class="profileEditingModal container d-none position-fixed top-50 start-50 translate-middle bg-white p-4 rounded-4 shadow">
            <h2>Profile Settings</h2>
            <div class="mb-3">
                <label for="editUsername" class="form-label">Username</label>
                <input type="text" class="form-control" id="editUsername" placeholder="Enter new username">
            </div>
            <div class="mb-3">
                <label for="editPassword" class="form-label">Password</label>
                <input type="password" class="form-control" id="editPassword" placeholder="Enter new password">
            </div>
            <button class="btn togglePassVisibility mb-2"><i class="passToggleIcon bi bi-eye "></i></button>
            <br>

            <label for="colorButtonsContainer">Choose Theme Color (Day):</label>
            <div class="d-flex align-items-center mb-3 mt-2 colorButtonsContainer align-items-center"
                id="colorButtonsContainer"></div>

            <button class="btn btn-primary" onclick="saveProfileChanges()">Save Changes</button>
            <button type="button" class="btn btn-secondary"
                onclick="document.querySelector('.profileEditingModal').classList.add('d-none')">Cancel</button>

        </div>

        <!--NOTE CREATION MODAL-->
        <div
            class="noteCreationModal container d-none position-fixed top-50 start-50 translate-middle bg-white p-4 rounded-4 shadow">
            <h2>Create Note</h2>
            <div class="mb-3">
                <label for="noteTitle" class="form-label">Title</label>
                <input type="text" class="form-control" id="noteTitle" placeholder="Enter note title" required>
            </div>
            <div class="mb-3">
                <label for="noteContent" class="form-label">Content</label>
                <textarea class="form-control" id="noteContent" rows="5" placeholder="Enter note content"
                    style="resize: none;" onkeypress="countLetters()" required></textarea>
                <p class="maxLetterCount "><span class="currentLetterCount">0</span>/1000</p>
            </div>
            <button class="btn btn-primary" onclick="saveNote()">Save Note</button>
            <button type="button" class="btn btn-secondary cancelBtn">Cancel</button>

        </div>

        <!--NOTE EDITING MODAL-->
        <div
            class="noteEditingModal container d-none position-fixed top-50 start-50 translate-middle bg-white p-4 rounded-4 shadow">
            <h2>Edit Note</h2>
            <div class="mb-3">
                <label for="noteTitle" class="form-label">Title</label>
                <input type="text" class="form-control" id="editNoteTitle" placeholder="Enter note title">
            </div>
            <div class="mb-3">
                <label for="noteContent" class="form-label">Content</label>
                <textarea class="form-control" id="editNoteContent" rows="5" placeholder="Enter note content"
                    style="resize: none;" onkeypress="countEditLetters()"></textarea>
                <p class="maxLetterCount "><span class="editCurrentLetterCount">0</span>/1000</p>
            </div>
            <button class="btn btn-primary" onclick="editNote()">Save Note</button>
            <button type="button" class="btn btn-secondary cancelBtn cancelEditBtn">Cancel</button>

        </div>

        <!--FABs ADD AND TO TOP-->
        <div class="floating-buttons d-none flex-column align-items-end gap-2">
            <button class="btn btn-secondary rounded-circle btn-sm shadow mb-2" id="scrollTopBtn" title="Scroll to Top"
                style="margin: auto;">
                <i class="bi bi-arrow-up" style="font-size: 1rem;"></i>
            </button>

            <button class="btn btn-primary rounded-circle btn-lg shadow-lg" id="scrollAddNoteBtn" title="Add New Note">
                <i class="bi bi-plus-lg" style="font-size: 1.5rem;"></i>
            </button>
        </div>


        <!--NOTES GRID-->
        <div class="notesGrid mt-4">
            <p class="text-center notesCountStatus" style="font-weight: lighter;"><i>You have no notes yet. Click "+
                    Add" to create your first note!</i></p>
        </div>



        <!--SKRIPTE ZA OVAJ PAGE-->
        <script>
            let isDarkMode = false;
            let isMinimal = localStorage.getItem("minimalMode") === false;

            //scroll header hide/show variables
            let lastScrollTop = 0;
            const header = document.querySelector("header");
            const deltaScroll = 1;
            const headerHeight = header.offsetHeight;

            //dark mode on page load
            window.addEventListener("DOMContentLoaded", () => {
                const savedMode = localStorage.getItem("darkmode");
                if (savedMode === "true") {
                    isDarkMode = true;
                    document.body.classList.add("dark-mode");
                    document.getElementById("toggleDarkMode").textContent = "â˜€ï¸";
                    document.getElementById("siteIcon").src = "./assets/icon_purplecircle.png";
                } else {
                    isDarkMode = false;
                    document.body.classList.remove("dark-mode");
                    document.getElementById("toggleDarkMode").textContent = "ðŸŒ™";
                    document.getElementById("siteIcon").src = "./assets/icon_whitecircle.png";
                }
            });

            //select color index on page load
            window.addEventListener("DOMContentLoaded", selectColorIndex);

            //set random profile color on page load
            window.addEventListener("DOMContentLoaded", setRandomProfileColor);

            //set random note card color on page load
            window.addEventListener("DOMContentLoaded", setRandomNoteCardColor);

            //set random profile text color on page load
            window.addEventListener("DOMContentLoaded", setRandomProfileTextColor);


            //scroll header hide/show
            window.addEventListener("scroll", () => {
                const floatingBtns = document.querySelector(".floating-buttons");
                const scrollAddNoteBtn = document.getElementById("scrollAddNoteBtn");
                const scrollTopBtn = document.getElementById("scrollTopBtn");
                const scrollTop = window.pageYOffset || document.documentElement.scrollTop;

                if (Math.abs(scrollTop - lastScrollTop) > deltaScroll) {
                    if (scrollTop > lastScrollTop && scrollTop > headerHeight) {
                        floatingBtns.classList.remove("d-none");
                        header.classList.add("hide");
                    } else {
                        floatingBtns.classList.add("suckIn");
                        setTimeout(() => {
                            floatingBtns.classList.add("d-none");
                        }, 300);

                        header.classList.remove("hide");
                    }
                    lastScrollTop = scrollTop;
                }

                scrollTopBtn.addEventListener("click", () => {
                    window.scrollTo({ top: 0, behavior: "smooth" });
                });

                scrollAddNoteBtn.addEventListener("click", openNoteCreationModal);
            });

            window.addEventListener("DOMContentLoaded", renderColorButtons)

            document.getElementById("toggleDarkMode").addEventListener("click", switchDarkMode);

            document.querySelector(".addNoteBtn").addEventListener("click", openNoteCreationModal);

            document.querySelector(".cancelBtn").addEventListener("click", () => {
                document.querySelector('.noteCreationModal').classList.add('d-none');
                document.querySelector("#noteTitle").value = "";
                document.querySelector("#noteContent").value = "";
            })

            document.querySelector(".cancelEditBtn").addEventListener("click", () => {
                document.querySelector('.noteEditingModal').classList.add('d-none');
                document.querySelector("#editNoteTitle").value = "";
                document.querySelector("#editNoteContent").value = "";
            })

            document.getElementById("LogOutButton").addEventListener("click", function () {
                localStorage.removeItem("username");
                localStorage.removeItem("password");
                window.location.href = "./index.html";
            });

            document.querySelector(".togglePassVisibility").addEventListener("click", () => {
                const passInput = document.querySelector("#editPassword");

                if (passInput.type === "password") {
                    passInput.type = "text";
                    document.querySelector(".passToggleIcon").classList.remove("bi-eye");
                    document.querySelector(".passToggleIcon").classList.add("bi-eye-slash");
                } else {
                    passInput.type = "password"
                    document.querySelector(".passToggleIcon").classList.add("bi-eye");
                    document.querySelector(".passToggleIcon").classList.remove("bi-eye-slash");
                }


            })

            window.onload = ReadUserData;
        </script>
</body>


</html>