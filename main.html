<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your Notes | GK NOTES</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <link rel="shortcut icon" href="./assets/icon_purplecircle.png" type="image/x-icon">
    <script src="./script.js"></script>
</head>

<body onload="ReadUserData()">
    <header
        class="d-flex justify-content-between align-items-center px-4 py-3 text-white shadow-sm position-fixed top-0 start-0 w-100">
        <div class="d-flex align-items-center gap-3">
            <a href="./main.html"><img src="./assets/icon_whitecircle.png" alt="GK NOTES Logo" width="75" height="75"
                    class="rounded-circle" id="siteIcon"></a>
            <button class="btn btn-outline-light rounded-pill px-3 addNoteBtn" title="Add new note">+ Add</button>
        </div>


        <div class="d-flex align-items-center gap-3">
            <button class="btn btn-outline-light rounded-circle" id="toggleDarkMode"
                title="Toggle dark mode">üåô</button>

            <button class="btn btn-outline-light rounded-circle" id="LogOutButton" title="Log Out">üö™</button>

            <div class="profile-container" title="Your Profile" onclick="openProfileEditingModal()">
                <div class="profile-pill">
                    <div class="profile-circle text-white d-flex justify-content-center align-items-center text-center"
                        id="profile-pill">
                        <span id="profile-pill-span"></span>
                    </div>
                    <span class="username ms-2" id="usernamePfp"></span>
                </div>
            </div>
        </div>
    </header>
    <div class="container mt-5 pt-5">
        <h1 class="text-center my-4" id="userInfoDisplay">üëãHello <span id="usernameTitle"></span>, here are your
            notes...</h1>

        <!--PROFILE EDITING MODAL-->
        <div
            class="profileEditingModal container d-none position-fixed top-50 start-50 translate-middle bg-white p-4 rounded-4 shadow">
            <h2>Edit Profile</h2>
            <div class="mb-3">
                <label for="editUsername" class="form-label">Username</label>
                <input type="text" class="form-control" id="editUsername" placeholder="Enter new username">
            </div>
            <div class="mb-3">
                <label for="editPassword" class="form-label">Password</label>
                <input type="password" class="form-control" id="editPassword" placeholder="Enter new password">
            </div>
            <button class="btn btn-primary" onclick="saveProfileChanges()">Save Changes</button>
            <button type="button" class="btn btn-secondary"
                onclick="document.querySelector('.profileEditingModal').classList.add('d-none')">Cancel</button>

        </div>

        <!--NOTE CREATION MODAL-->
        <div
            class="noteCreationModal container d-none position-fixed top-50 start-50 translate-middle bg-white p-4 rounded-4 shadow">
            <h2>Create Note</h2>
            <div class="mb-3">
                <label for="noteTitle" class="form-label">Title</label>
                <input type="text" class="form-control" id="noteTitle" placeholder="Enter note title">
            </div>
            <div class="mb-3">
                <label for="noteContent" class="form-label">Content</label>
                <textarea class="form-control" id="noteContent" rows="5" placeholder="Enter note content"
                    style="resize: none;" onkeypress="countLetters()"></textarea>
                <p class="maxLetterCount "><span class="currentLetterCount">0</span>/1000</p>
            </div>
            <button class="btn btn-primary" onclick="saveNote()">Save Note</button>
            <button type="button" class="btn btn-secondary"
                onclick="document.querySelector('.noteCreationModal').classList.add('d-none')">Cancel</button>

        </div>

        <!--NOTES GRID-->
        <div class="notesGrid mt-4">
            <p class="text-center notesCountStatus"><i>You have no notes yet. Click "+ Add" to create your first
                    note!</i></p>
        </div>



        <!--SKRIPTE ZA OVAJ PAGE-->
        <script>
            let isDarkMode = false;

            window.addEventListener("DOMContentLoaded", () => {
                const savedMode = localStorage.getItem("darkmode");
                if (savedMode === "true") {
                    isDarkMode = true;
                    document.body.classList.add("dark-mode");
                    document.getElementById("toggleDarkMode").textContent = "‚òÄÔ∏è";
                    document.getElementById("siteIcon").src = "./assets/icon_purplecircle.png";
                } else {
                    isDarkMode = false;
                    document.body.classList.remove("dark-mode");
                    document.getElementById("toggleDarkMode").textContent = "üåô";
                    document.getElementById("siteIcon").src = "./assets/icon_whitecircle.png";
                }
            });

            window.addEventListener("DOMContentLoaded", selectColorIndex);

            window.addEventListener("DOMContentLoaded", setRandomProfileColor);

            window.addEventListener("DOMContentLoaded", setRandomNoteCardColor);

            window.addEventListener("DOMContentLoaded", setRandomProfileTextColor);

            document.getElementById("toggleDarkMode").addEventListener("click", switchDarkMode);

            document.querySelector(".addNoteBtn").addEventListener("click", openNoteCreationModal);

            document.getElementById("LogOutButton").addEventListener("click", function () {
                localStorage.removeItem("username");
                localStorage.removeItem("password");
                window.location.href = "./index.html";
            });

            function getUsernameDisplay(name) {

                const parts = name.split(/[\.\_\-\+\@]/);

                let displayName = parts[0];

                displayName = displayName.charAt(0).toUpperCase() + displayName.slice(1);

                return displayName;
            }
            function ReadUserData() {
                const username = localStorage.getItem("username") || "Guest";
                const password = localStorage.getItem("password") || "";
                let displayUsername = getUsernameDisplay(username);


                let info = document.getElementById("usernameTitle");
                info.innerText = displayUsername;

                let pfpName = document.getElementById("usernamePfp");
                pfpName.innerText = username;

                let pfpShortName = displayUsername.charAt(0).toUpperCase();
                document.getElementById("profile-pill-span").innerText = pfpShortName;

                this.document.title = displayUsername + "'s Notes | GK NOTES";
            }
            window.onload = ReadUserData;

            function openProfileEditingModal() {
                document.querySelector('.profileEditingModal').classList.remove('d-none');
            }

            function saveProfileChanges() {
                let newUsername = document.getElementById("editUsername").value.trim();
                let newPassword = document.getElementById("editPassword").value;

                if (newUsername) {
                    let shortName = newUsername.split("@")[0];
                    newUsername = shortName.charAt(0).toUpperCase() + shortName.slice(1);

                    localStorage.setItem("username", newUsername);
                }

                if (newPassword) {
                    localStorage.setItem("password", newPassword);
                }

                ReadUserData();

                document.querySelector('.profileEditingModal').classList.add('d-none');

                alert("Profile updated successfully!");
            }
        </script>
</body>

</html>